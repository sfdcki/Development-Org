/**
*  Stat Map SVG Plugin version 1.2.0
*  (c) 2014 Danukidd
*
*  dependency : jquery.js, svg.js, canvg.js
*
*/
(function(e){e.fn.statMapSVG=function(t){var n=this;var r=e(n).attr("id");var i,s,o,u,a,f,l,c,h,p,d,v,m=1,g="",y="",b,w,E,S,x=0;var T,N,C,k,L=0,A=0,O=false;var M=Math.max(navigator.appVersion.indexOf("WebKit"),navigator.appVersion.indexOf("Safari"),0);var _=false;if(navigator.userAgent.indexOf("Gecko")>=0)_=parseFloat(navigator.userAgent.split("Firefox/")[1])||undefined;var D={move:function(t){var n=t.pageX+50;var r=t.pageY+20;e("div.kiddtooltip").css({top:r+50,left:n,opacity:1})},show:function(t,n){e("div.kiddtooltip").remove();e('<div class="kiddtooltip">'+jQuery.trim(n)+"</div>").appendTo("body");D.move(t)},hide:function(){e("div.kiddtooltip").remove()}};var P=function(t){if(st.opt){t.map=e.extend(st.opt.map,t.map);t.legend=e.extend(st.opt.legend,t.legend);t=e.extend(st.opt,t);st.opt=t}else{t.map=e.extend({svgFile:false,title:"",useGroup:false,width:"400px",height:"400px",fill:"#7798ba",stroke:"#fff",strokeWidth:"2px",hoverFill:.3,hoverStroke:"#fff",hoverStrokeWidth:"1px",selected:true,selectedFill:-.5,selectedStroke:"#aaaaaa",selectedStrokeWidth:"1px",showTooltip:false,pan:false,responsive:true,download:true,loader:{type:"bar",color:"#999999",text:"Loading ..."},devMode:false,patterns:[],markers:[],gradients:[],funcs:{}},t.map);t.data=e.extend({area:{},group:{}},t.data);t.legend=e.extend({showLegend:false,showId:true,showValue:false,showGroupLegend:false,parentAreaNm:"",parentAreaValue:"",areaLabel:"",valueLabel:"",groupLabel:"",position:"right"},t.legend);t=e.extend({map:t.map,data:t.data,legend:t.legend},t);st.opt=t}for(var n in st.opt.data.area){if(st.opt.map.useGroup){var r=st.opt.data.area[n].groupId;if(r){st.opt.data.area[n].color=st.opt.data.group[r].color;if(!st.opt.data.group[r].area)st.opt.data.group[r].area=[];st.opt.data.group[r].area.push(n)}}}return st.opt};var H=function(){if(f){var t=1;var n=f.rootElement;n.style.opacity=t;n.currentScale=t;var r=function(n){var i=f.rootElement;var s=parseFloat(i.style.opacity)+t;i.style.opacity=s;i.currentScale+=t;if(i.style.opacity<1){var o=setTimeout(function(){r(n)},10)}else{i.style.opacity=1;i.currentScale=1;if(!i.currentScale){var u=window.location.toString();u=u.split("?");if(!u[1])u=u[0]+"?";else u=u[0]+"?"+u[1]+"&";u+="svg.render.forceflash=true";window.location=u}clearTimeout(o);if(l){l.style.fill=n.opt.map.fill;l.style.stroke=n.opt.map.stroke;l.style.strokeWidth=n.opt.map.strokeWidth;l.style.cursor="default"}else if(svgweb.getHandlerType()=="native"){e("path",f).not("#lines, #labels").each(function(t){var r=e(this).attr("id");var i=f.getElementById(r);i.style.fill=n.opt.map.fill;i.style.stroke=n.opt.map.stroke;i.style.strokeWidth=n.opt.map.strokeWidth})}for(var a in n.opt.data.area){var c=f.getElementById(a);if(c){var h=n.opt.data.area[a].color;if(!h){if(l)h="inherit";else h=n.opt.map.fill}c.style.fill=h;c.style.stroke=n.opt.map.stroke;c.style.strokeWidth=n.opt.map.strokeWidth;e(c).children().each(function(){this.style.fill="inherit";this.style.stroke="inherit";this.style.strokeWidth="inherit";this.style.cursor="inherit"})}}}};r(st)}};var B=function(e,t,n){var r=e;var i="";var s="";if(t!=null){s="statmap-"+t.objectActive.type;switch(t.objectActive.type){case"circle":case"rect":if(typeof t.objectActive.attr.style.fill!=="undefined"&&t.objectActive.attr.style.fill!="none")i+="background-color: "+t.objectActive.attr.style.fill+" !important;";if(typeof t.objectActive.attr.style.stroke!=="undefined"&&t.objectActive.attr.style.stroke!="none")i+="border: 1px solid "+t.objectActive.attr.style.stroke+";";break;case"line":i+="border-bottom: 1px solid "+t.objectActive.attr.style.stroke+";";break;case"polygon":i+="position: relative;";r='<div style="position: absolute; top:-7; left: -7; z-index: 3;">'+r+"</div>";var o=typeof t.objectActive.attr.style.stroke==="undefined"||t.objectActive.attr.style.stroke=="none"?"white":t.objectActive.attr.style.stroke;i+="border-left: 10px solid "+o+";";var u=typeof t.objectActive.attr.style.fill==="undefined"||t.objectActive.attr.style.fill=="none"?"white":t.objectActive.attr.style.fill;r='<div class="statmap-polygon-top" style="border-left : 7px solid '+u+';"></div>'+r;break;case"image":i+="position: relative;";r='<img src="'+t.objectActive.attr.url+'" class="'+s+'"/><div style="position: absolute; top:0; left: 0; z-index: 3;">'+r+"</div>";break}}return'<div class="'+s+'" style="'+i+'">'+r+"</div>"};var j=function(e){var t="";if(e!=null){var n=[];for(var r in e.stops){var i=e.stops[r];n.push(i["stop-color"])}if(e.type=="linear"){t+="background: linear-gradient("+n.join()+") !important;";t+="background: -webkit-linear-gradient("+n.join()+");";t+="background: -o-linear-gradient("+n.join()+");";t+="background: -moz-linear-gradient("+n.join()+");"}else{t+="background: radial-gradient("+n.join()+") !important;";t+="background: -webkit-radial-gradient("+n.join()+");";t+="background: -o-radial-gradient("+n.join()+");";t+="background: -moz-radial-gradient("+n.join()+");"}}return t};var F=function(){if(a)a.remove();a=e('<div id="mapLegend'+r+'" class="mapLegend" style="display:none"></div>');switch(st.opt.legend.position){case"right":a.css({"float":"left"}).appendTo(e(n));break;case"left":a.css({"float":"left"}).insertAfter(i);break;case"top":a.insertAfter(i);break;case"bottom":e('<div style="clear:both"></div>').appendTo(e(n));a.appendTo(e(n));break;default:break}if(st.opt.legend.showLegend){var t='<table id="tableValue'+r+'">';if(st.opt.legend.areaLabel||st.opt.legend.valueLabel){t+='<thead><tr><th colspan="2">'+st.opt.legend.areaLabel+"</th>";if(st.opt.legend.showValue)t+="<th>"+st.opt.legend.valueLabel+"</th>";t+="</tr></thead><tbody>"}for(var s in st.opt.data.area){if(f){var o=f.getElementById(s);if(o){var l=st.opt.data.area[s].nm;var c=st.opt.data.area[s].value;var h=st.opt.data.area[s].color;if(!h)h=st.opt.map.fill;t+='<tr id="'+s+'" class="lr">';if(h.indexOf("url")==-1){t+='<td style="background-color:'+h+' !important;width:20px;" class="ctext">';if(st.opt.legend.showId)t+=s}else{var p=h.substring(o.style.fill.lastIndexOf("#"),h.lastIndexOf(")")).replace("#","");var d=null;for(var v=0,m=st.opt.map.patterns.length;v<m;v++){if(st.opt.map.patterns[v].id==p){d=st.opt.map.patterns[v];break}}if(d!=null){t+='<td style="width:20px;" class="ctext">';t+=st.opt.legend.showId?B(s,d):B("",d)}else{var g=null;for(var v=0,m=st.opt.map.gradients.length;v<m;v++){if(st.opt.map.gradients[v].id==p){g=st.opt.map.gradients[v];break}}t+='<td style="'+j(g)+'width:20px;" class="ctext">';if(st.opt.legend.showId)t+=s}}t+='</td><td class="lr">'+l+"</td>";if(st.opt.legend.showValue)t+='<td class="lr rtext">'+c+"</td>";t+="</tr>"}}}if(st.opt.legend.parentAreaNm||st.opt.legend.parentAreaValue){t+='<tr class="parentArea"><td class="ctext" colspan=2>'+st.opt.legend.parentAreaNm+"</td>";if(st.opt.legend.showValue)t+='<td class="rtext">'+st.opt.legend.parentAreaValue+"</td>";t+="</tr>"}t+="</tbody></table>";e(t).appendTo(a)}if(st.opt.map.useGroup){if(st.opt.legend.showGroupLegend){var t='<table id="tableGroup'+r+'">';if(st.opt.legend.groupLabel)t+='<thead><tr><th colspan="2">'+st.opt.legend.groupLabel+"</th></tr></thead><tbody>";for(var y in st.opt.data.group){var b=st.opt.data.group[y].nm;var h=st.opt.data.group[y].color;if(h.indexOf("url")==-1){t+='<tr id="'+y+'" class="lr"><td style="background-color:'+h+' !important;width:20px;"></td><td class="lr">'+b+"</td></tr>"}else{var p=h.substring(h.lastIndexOf("#"),h.lastIndexOf(")")).replace("#","");var d=null;for(var v=0,m=st.opt.map.patterns.length;v<m;v++){if(st.opt.map.patterns[v].id==p){d=st.opt.map.patterns[v];break}}if(d!=null){t+='<tr id="'+y+'" class="lr"><td style="width:20px;">'+B("",d)+'</td><td class="lr">'+b+"</td></tr>"}else{var g=null;for(var v=0,m=st.opt.map.gradients.length;v<m;v++){if(st.opt.map.gradients[v].id==p){g=st.opt.map.gradients[v];break}}t+='<tr id="'+y+'" class="lr"><td style="'+j(g)+'width:20px;"></td><td class="lr">'+b+"</td></tr>"}}}t+="</tbody></table>";e(t).appendTo(a)}}e("table tbody tr.lr",a).css("cursor","default");if(u)u.remove();u=e('<div id="clr'+r+'" style="clear:both;"></div>');u.appendTo(e(n));a.show(1e3)};var I=function(t){y="";if(svgweb.getHandlerType()=="native"){e("path",f).not("#lines, #labels").each(function(t){var n=e(this).attr("id");U(n)})}for(var n in st.opt.data.area){st.opt.data.area[n].selected=false;U(n)}var r=e(this).attr("id");var i={};if(typeof st.opt.data.area[r]!=="undefined"){i=st.opt.data.area[r];i.id=r;if(typeof st.opt.data.area[r].onClick==="function")st.opt.data.area[r].onClick(t,i);else st.opt.map.funcs.onClick(t,i);if(st.opt.map.selected){i.selected=true;z(r)}}else{i.id=r;st.opt.map.funcs.onClick(t,i);if(st.opt.map.selected){y=r;z(r)}}if(st.opt.map.showTooltip)D.hide()};var q=function(){if(f){var t=f.rootElement;t.addEventListener("mousemove",Q,false);if(st.opt.map.pan){t.addEventListener("mousedown",K,false);t.addEventListener("mouseup",G,false)}if(st.opt.map.zoom){if(svgweb.getHandlerType()=="native")V(t,"mousewheel",J);else V("file","mousewheel",J)}}if(svgweb.getHandlerType()=="native"){e("path",f).not("#lines, #labels").each(function(t){var n=e(this).attr("id");var r=f.getElementById(n);if(r){if(typeof st.opt.map.funcs.onClick==="function"){r.style.cursor="pointer";r.addEventListener("click",I,false)}r.addEventListener("mousemove",function(e){if(st.opt.map.showTooltip)D.move(e)},false);r.addEventListener("mouseover",function(e){g=n;R(n);if(st.opt.map.showTooltip)D.show(e,n)},false);r.addEventListener("mouseout",function(e){g="";U(n);if(st.opt.map.showTooltip)D.hide()},false)}})}if(f){for(var n in st.opt.data.area){var i=f.getElementById(n);if(i){if(typeof st.opt.map.funcs.onClick==="function"||typeof st.opt.data.area[n].onClick==="function"&&typeof st.opt.map.funcs.onClick!=="function"){i.style.cursor="pointer";i.addEventListener("click",I,false)}if(typeof st.opt.map.funcs.mouseMove==="function"||typeof st.opt.data.area[n].mouseMove==="function"&&typeof st.opt.map.funcs.mouseMove!=="function"){i.addEventListener("mousemove",function(t){var n=e(this).attr("id");var r=st.opt.data.area[n];r.id=n;if(st.opt.map.showTooltip)D.move(t);if(typeof st.opt.data.area[n].mouseMove==="function")st.opt.data.area[n].mouseMove(t,r);else st.opt.map.funcs.mouseMove(t,r)},false)}else{i.addEventListener("mousemove",function(e){if(st.opt.map.showTooltip)D.move(e)},false)}if(typeof st.opt.map.funcs.mouseOver==="function"||typeof st.opt.data.area[n].mouseOver==="function"&&typeof st.opt.map.funcs.mouseOver!=="function"){i.addEventListener("mouseover",function(t){var n=e(this).attr("id");g=n;R(n);var r=st.opt.data.area[n];r.id=n;if(st.opt.map.showTooltip){var i="";if(typeof r.tooltip!=="undefined")i=r.tooltip;else if(typeof r.value!=="undefined"){i=r.nm+" (";i+=st.opt.legend.valueLabel!=""?st.opt.legend.valueLabel+" : "+r.value:r.value;i+=")"}else i=r.nm;D.show(t,i)}if(typeof st.opt.data.area[n].mouseOver==="function")st.opt.data.area[n].mouseOver(t,r);else st.opt.map.funcs.mouseOver(t,r)},false)}else{i.addEventListener("mouseover",function(t){var n=e(this).attr("id");g=n;R(n);var r=st.opt.data.area[n];if(st.opt.map.showTooltip){var i="";if(typeof r.tooltip!=="undefined")i=r.tooltip;else if(typeof r.value!=="undefined"){i=r.nm+" (";i+=st.opt.legend.valueLabel!=""?st.opt.legend.valueLabel+" : "+r.value:r.value;i+=")"}else i=r.nm;D.show(t,i)}},false)}if(typeof st.opt.map.funcs.mouseOut==="function"||typeof st.opt.data.area[n].mouseOut==="function"&&typeof st.opt.map.funcs.mouseOut!=="function"){i.addEventListener("mouseout",function(t){var n=e(this).attr("id");g="";U(n);var r=st.opt.data.area[n];r.id=n;if(st.opt.map.showTooltip)D.hide();if(typeof st.opt.data.area[n].mouseOut==="function")st.opt.data.area[n].mouseOut(t,r);else st.opt.map.funcs.mouseOut(t,r)},false)}else{i.addEventListener("mouseout",function(t){var n=e(this).attr("id");g="";U(n);if(st.opt.map.showTooltip)D.hide()},false)}}}}if(st.opt.legend.showLegend){e("table#tableValue"+r+" tbody tr.lr",a).each(function(){e(this).hover(function(){var t=e(this).attr("id");R(t)},function(){var t=e(this).attr("id");U(t)})})}if(st.opt.map.useGroup){if(st.opt.legend.showGroupLegend){e("table#tableGroup"+r+" tbody tr.lr",a).each(function(){e(this).hover(function(){var t=e(this).attr("id");var n=st.opt.data.group[t].area;for(var r in n){var i=n[r];R(i)}},function(){var t=e(this).attr("id");var n=st.opt.data.group[t].area;for(var r in n){var i=n[r];U(i)}})})}}};var R=function(t){var n=f.getElementById(t);var r=st.opt.map.hoverFill;if(typeof r==="number"){if(typeof st.opt.data.area[t]!=="undefined"){var i=st.opt.data.area[t].color?st.opt.data.area[t].color:st.opt.map.fill;if(st.opt.data.area[t].selected){if(typeof st.opt.map.selectedFill==="number")r=Y(i,r+st.opt.map.selectedFill);else r=Y(n.style.fill,r)}else r=Y(i,r)}else{if(y!=""){if(typeof st.opt.map.selectedFill==="number")r=Y(st.opt.map.fill,r+st.opt.map.selectedFill);else r=Y(n.style.fill,r)}else r=Y(st.opt.map.fill,r)}}if(n.style.fill.indexOf("url")==-1)n.style.fill=r;else if(typeof st.opt.data.area[t]!=="undefined"){var s=st.opt.data.area[t].color.substring(n.style.fill.lastIndexOf("#"),st.opt.data.area[t].color.lastIndexOf(")")).replace("#","");var o=null;for(var u=0,l=st.opt.map.patterns.length;u<l;u++){if(st.opt.map.patterns[u].id==s){o=st.opt.map.patterns[u];break}}if(o!=null&&typeof o.objectHover!=="undefined"){n.style.fill="url(#"+s+"_hover)"}else n.style.fill=r}n.style.stroke=st.opt.map.hoverStroke;n.style.strokeWidth=st.opt.map.hoverStrokeWidth;e("table tbody tr#"+t,a).children("td.lr").css("background-color",r);if(st.opt.map.useGroup&&typeof st.opt.data.area[t]!=="undefined"){var c=st.opt.data.area[t].groupId;e("table tbody tr#"+c,a).children("td.lr").css("background-color",r)}};var U=function(t){var n=f.getElementById(t);var r="background",i="none";var s=st.opt.map.fill;if(typeof st.opt.data.area[t]!=="undefined")s=st.opt.data.area[t].color;var o=st.opt.map.stroke;var u=st.opt.map.strokeWidth;if(typeof st.opt.data.area[t]!=="undefined"&&st.opt.data.area[t].selected||y==t){if(typeof st.opt.map.selectedFill==="number"){if(y==t)s=Y(st.opt.map.fill,st.opt.map.selectedFill);else s=Y(st.opt.data.area[t].color,st.opt.map.selectedFill)}else s=st.opt.map.selectedFill;r="background-color";i=s;o=st.opt.map.selectedStroke;u=st.opt.map.selectedStrokeWidth}if(!s){if(l)s="inherit";else s=st.opt.map.fill}n.style.fill=s;n.style.stroke=o;n.style.strokeWidth=u;e("table tbody tr#"+t,a).children("td.lr").css(r,i);if(st.opt.map.useGroup&&typeof st.opt.data.area[t]!=="undefined"){var c=st.opt.data.area[t].groupId;e("table tbody tr#"+c,a).children("td.lr").css(r,i)}};var z=function(t){var n=f.getElementById(t);var r=st.opt.map.selectedFill;if(typeof r==="number"){r=typeof st.opt.data.area[t]!=="undefined"&&st.opt.data.area[t].color?Y(st.opt.data.area[t].color,r):Y(st.opt.map.fill,r)}n.style.fill=r;n.style.stroke=st.opt.map.selectedStroke;n.style.strokeWidth=st.opt.map.selectedStrokeWidth;e("table tbody tr#"+t,a).children("td.lr").css("background-color",r);if(st.opt.map.useGroup&&typeof st.opt.data.area[t]!=="undefined"){var i=st.opt.data.area[t].groupId;e("table tbody tr#"+i,a).children("td.lr").css("background-color",r)}};var W=function(t){if(f){var n=f.rootElement;if(t==1){if(svgweb.getHandlerType()=="flash")n.currentScale=1;else{m=1;if(l)e("#header, #area, #areaId",f).each(function(){f.getElementById(e(this).attr("id")).setAttribute("transform","scale("+m+")")});else e("path, circle, rect, ellipse, text, line, polyline, polygon, image",f).each(function(){if(e(this).attr("id")!=null)f.getElementById(e(this).attr("id")).setAttribute("transform","scale("+m+")")})}}else{if(svgweb.getHandlerType()=="flash")n.currentScale*=t;else{m*=t;if(l)e("#header, #area, #areaId",f).each(function(){f.getElementById(e(this).attr("id")).setAttribute("transform","scale("+m+")")});else e("path, circle, rect, ellipse, text, line, polyline, polygon, image",f).each(function(){if(e(this).attr("id")!=null)f.getElementById(e(this).attr("id")).setAttribute("transform","scale("+m+")")})}}}};var X=function(e,t){if(f){var n=f.rootElement;if(e==0&&t==0){n.currentTranslate.x=e;n.currentTranslate.y=t;L=0;A=0}else{n.currentTranslate.x=n.currentTranslate.x+e;n.currentTranslate.y=n.currentTranslate.y+t}}};var V=function(e,t,n){if(typeof e=="string")e=document.getElementById(e);if(e==null)return;if(e.addEventListener){if(t=="mousewheel")e.addEventListener("DOMMouseScroll",n,false);e.addEventListener(t,n,false)}else if(e.attachEvent)e.attachEvent("on"+t,n)};var J=function(e){e=e?e:window.event;var t=e.detail?e.detail*-1:e.wheelDelta;var n=f.rootElement;if(t>0){n.style.cursor="zoom-in";W(10/9)}else{n.style.cursor="zoom-out";W(9/10)}if(e.preventDefault)e.preventDefault();return false};var K=function(e){O=true;T=e.clientX;N=e.clientY;var t=f.rootElement;C=t.currentTranslate.x;k=t.currentTranslate.y;t.style.cursor="move";e.preventDefault(true)};var Q=function(t){var n=f.rootElement;if(!O){n.style.cursor="default";if(svgweb.getHandlerType()=="native"){if(g!=""&&(typeof st.opt.map.funcs.onClick==="function"||typeof st.opt.data.area[g]!=="undefined"&&typeof st.opt.data.area[g].onClick==="function"&&typeof st.opt.map.funcs.onClick!=="function")){var r=f.getElementById(g);r.addEventListener("click",I,false)}if(st.opt.map.devMode){var i=(t.clientX-L-(parseFloat(st.opt.map.width)-b)/2)/b*n.getAttribute("width");var s=(t.clientY-A-(parseFloat(st.opt.map.height)-w)/2)/w*n.getAttribute("height");e("#coordx").val(i.toFixed(2));e("#coordy").val(s.toFixed(2));e("#idarea").val(g)}}return}if(svgweb.getHandlerType()=="native"){if(g!=""){var r=f.getElementById(g);r.removeEventListener("click",I,false)}}L=t.clientX-T;A=t.clientY-N;if(M||svgweb.getHandlerType()=="flash"){L/=n.currentScale;A/=n.currentScale}var o=C+L;var u=k+A;if(_){c=this;this.setAttribute("transform","translate("+o+","+u+")")}else{n.currentTranslate.x=o;n.currentTranslate.y=u}t.preventDefault(true)};var G=function(e){O=false;var t=f.rootElement;t.style.cursor="default";e.preventDefault(true)};var Y=function(e,t){e=String(e).replace(/[^0-9a-f]/gi,"");if(e.length<6)e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2];t=t||0;var n="#",r,i;for(i=0;i<3;i++){r=parseInt(e.substr(i*2,2),16);r=Math.round(Math.min(Math.max(0,r+r*t),255)).toString(16);n+=("00"+r).substr(r.length)}return n};var Z=function(e,t,n){var r=e.width;var i=e.height;var s;var o=e.getContext("2d");if(n){s=o.getImageData(0,0,r,i);var u=o.globalCompositeOperation;o.globalCompositeOperation="destination-over";o.fillStyle=n;o.fillRect(0,0,r,i)}var a=e.toDataURL(t);if(n){o.clearRect(0,0,r,i);o.putImageData(s,0,0);o.globalCompositeOperation=u}return a};var et=function(){var e=typeof st.opt.map.loader.color==="undefined"?"":'style="background-color:'+st.opt.map.loader.color+';"';var t=typeof st.opt.map.loader.type==="undefined"?"bar":st.opt.map.loader.type;switch(t){case"bar":return'<div id="loader'+r+'" class="spinner spinner-'+t+'"><div class="rect1" '+e+'></div><div class="rect2" '+e+'></div><div class="rect3" '+e+'></div><div class="rect4" '+e+'></div><div class="rect5" '+e+"></div></div>";break;case"bounce":return'<div id="loader'+r+'" class="spinner spinner-'+t+'"><div class="spinner-container container1"><div class="circle1" '+e+'></div><div class="circle2" '+e+'></div><div class="circle3" '+e+'></div><div class="circle4" '+e+'></div></div><div class="spinner-container container2"><div class="circle1" '+e+'></div><div class="circle2" '+e+'></div><div class="circle3" '+e+'></div><div class="circle4" '+e+'></div></div><div class="spinner-container container3"><div class="circle1" '+e+'></div><div class="circle2" '+e+'></div><div class="circle3" '+e+'></div><div class="circle4" '+e+"></div></div></div>";break;case"text":var n=typeof st.opt.map.loader.text==="undefined"?"Loading ...":st.opt.map.loader.text;return'<div id="loader'+r+'" class="spinner spinner-'+t+'">'+n+"</div>";break;default:break}};var tt=function(){if(f&&st.opt.map.gradients.length>0){var e=f.rootElement;var t=e.getElementsByTagNameNS(svgns,"defs")[0];for(var n in st.opt.map.gradients){var r=st.opt.map.gradients[n];var i=document.createElementNS(svgns,r.type+"Gradient");i.setAttribute("id",r.id);if(r.type=="linear"){i.setAttribute("x1",r.attr.startPoint[0]);i.setAttribute("y1",r.attr.startPoint[1]);i.setAttribute("x2",r.attr.endPoint[0]);i.setAttribute("y2",r.attr.endPoint[1])}else{if(typeof r.attr.center!=="undefined"){i.setAttribute("cx",r.attr.center[0]);i.setAttribute("cy",r.attr.center[1])}i.setAttribute("fx",r.attr.focalPoint[0]);i.setAttribute("fy",r.attr.focalPoint[1]);i.setAttribute("r",r.attr.radius)}i.setAttribute("spreadMethod",typeof r.attr.spreadMethod==="undefined"?"pad":r.attr.spreadMethod);if(typeof r.attr.gradientTransform!=="undefined")i.setAttribute("gradientTransform",r.attr.gradientTransform);for(var s in r.stops){var o=document.createElementNS(svgns,"stop");var u=r.stops[s];for(var a in u){if(u.hasOwnProperty(a)){o.setAttribute(a,u[a])}}i.appendChild(o)}t.appendChild(i)}}};var nt=function(){if(f&&st.opt.map.patterns.length>0){var e=f.rootElement;var t=e.getElementsByTagNameNS(svgns,"defs")[0];for(var n in st.opt.map.patterns){var r=st.opt.map.patterns[n];var i=document.createElementNS(svgns,r.objectActive.type);i=rt(r.objectActive,i);var s=document.createElementNS(svgns,"pattern");s.setAttribute("id",r.id);s.setAttribute("x",r.coordinates[0]);s.setAttribute("y",r.coordinates[1]);s.setAttribute("width",r.size[0]);s.setAttribute("height",r.size[1]);s.setAttribute("patternUnits","userSpaceOnUse");if(typeof r.patternTransform!=="undefined")s.setAttribute("patternTransform",r.patternTransform);s.appendChild(i);t.appendChild(s);if(typeof r.objectHover!=="undefined"){var o=document.createElementNS(svgns,r.objectHover.type);o=rt(r.objectHover,o);var u=document.createElementNS(svgns,"pattern");u.setAttribute("id",r.id+"_hover");u.setAttribute("x",r.coordinates[0]);u.setAttribute("y",r.coordinates[1]);u.setAttribute("width",r.size[0]);u.setAttribute("height",r.size[1]);u.setAttribute("patternUnits","userSpaceOnUse");if(typeof r.patternTransform!=="undefined")u.setAttribute("patternTransform",r.patternTransform);u.appendChild(o);t.appendChild(u)}}}};var rt=function(e,t){switch(e.type){case"rect":t.setAttribute("x",e.attr.coordinates[0]);t.setAttribute("y",e.attr.coordinates[1]);t.setAttribute("width",e.attr.size[0]);t.setAttribute("height",e.attr.size[1]);if(typeof e.attr.rcorner!=="undefined"){t.setAttribute("rx",e.attr.rcorner[0]);t.setAttribute("ry",e.attr.rcorner[1])}break;case"circle":t.setAttribute("cx",e.attr.coordinates[0]);t.setAttribute("cy",e.attr.coordinates[1]);t.setAttribute("r",e.attr.radius);break;case"ellipse":t.setAttribute("cx",e.attr.coordinates[0]);t.setAttribute("cy",e.attr.coordinates[1]);t.setAttribute("rx",e.attr.radius[0]);t.setAttribute("ry",e.attr.radius[1]);break;case"line":t.setAttribute("x1",e.attr.coordinates[0][0]);t.setAttribute("y1",e.attr.coordinates[0][1]);t.setAttribute("x2",e.attr.coordinates[1][0]);t.setAttribute("y2",e.attr.coordinates[1][1]);break;case"polyline":case"polygon":for(T in e.attr.coordinates){if(e.attr.coordinates[T]instanceof Array){e.attr.coordinates[T]=e.attr.coordinates[T].toString()}}var n=e.attr.coordinates.join(" ");t.setAttribute("points",n);break;case"path":t.setAttribute("d",e.attr.drawing);break;case"text":t.setAttribute("x",e.attr.coordinates[0]);t.setAttribute("y",e.attr.coordinates[1]);if(typeof e.attr.transform!=="undefined")t.setAttribute("transform",e.attr.transform);if(typeof e.attr.textLength!=="undefined")t.setAttribute("textLength",e.attr.textLength);if(typeof e.attr.lengthAdjust!=="undefined")t.setAttribute("lengthAdjust",e.attr.lengthAdjust);var r=document.createTextNode(e.value,true);t.appendChild(r);break;case"image":t.setAttribute("x",e.attr.coordinates[0]);t.setAttribute("y",e.attr.coordinates[1]);t.setAttribute("width",e.attr.size[0]);t.setAttribute("height",e.attr.size[1]);t.setAttributeNS(xlinkns,"xlink:href",e.attr.url);break}if(typeof e.attr.style!=="undefined"){for(var i in e.attr.style){if(e.attr.style.hasOwnProperty(i)){t.setAttribute(i,e.attr.style[i])}}}return t};var it=function(){if(f&&st.opt.map.markers.length>0){var t=f.rootElement;for(var n in st.opt.map.markers){var r=st.opt.map.markers[n];var i=document.createElementNS(svgns,r.type);if(typeof r.attr.id!=="undefined")i.setAttribute("id",r.attr.id);else{i.setAttribute("id",r.type+x);x++}i=rt(r,i);(function(t,n){if(typeof t.tooltip!=="undefined"&&t.tooltip!=""){n.addEventListener("mousemove",function(e){D.move(e)},false);n.addEventListener("mouseover",function(e){g=this.getAttribute("id");D.show(e,t.tooltip)},false);n.addEventListener("mouseout",function(e){D.hide()},false)}if(typeof t.attr.hover!=="undefined"){n.addEventListener("mousemove",function(e){n.setAttributeNS(xlinkns,"xlink:href",t.attr.hover)},false);n.addEventListener("mouseover",function(e){n.setAttributeNS(xlinkns,"xlink:href",t.attr.hover)},false);n.addEventListener("mouseout",function(e){n.setAttributeNS(xlinkns,"xlink:href",t.attr.url)},false)}if(typeof t.onClick==="function"){n.style.cursor="pointer";n.addEventListener("click",function(r){var i={};i.id=e(this).attr("id");i.elem=n;t.onClick(r,i)},false)}if(typeof t.href!=="undefined"&&t.href!=""){n.style.cursor="pointer";n.addEventListener("click",function(e){if(typeof t.newtab!=="undefined"&&t.newtab)window.open(t.href,"_blank");else window.location.href=t.href},false)}})(st.opt.map.markers[n],i);t.appendChild(i)}}};var st={generate:function(){st=this;var t=document.nativeGetElementById?document.getElementById("mapWrap"+r):document.all["mapWrap"+r];if(t){for(var a=0;a<t.childNodes.length;a++){var m=t.childNodes[a];try{svgweb.removeChild(m,t)}catch(g){console.log("Error removing child: "+(g.message||g))}}e(n).children().remove()}e(n).addClass("statMapSVG");i=e('<div id="mapTitle'+r+'" class="mapTitle">'+st.opt.map.title+"</div>");i.appendTo(e(n));s=e('<div id="mapWrap'+r+'" name="mapWrap'+r+'" class="mapWrap" style="width:'+st.opt.map.width+";height:"+st.opt.map.height+';position: relative;"></div>');s.appendTo(e(n));d=s.width();v=s.height();o=e('<div id="mapContainer'+r+'"></div>');o.appendTo(s);e(et()).appendTo(s);if(st.opt.map.zoom&&st.opt.map.zoomButtons.show){h=e('<div id="mapZoom'+r+'" class="mapZoom noprint" style="position: absolute;"><button class="plus" title="zoom in">+</button><button class="min" title="zoom out">-</button><button class="reset" title="reset">&times;</button></div>');h.appendTo(s);switch(st.opt.map.zoomButtons.location){case"tr":if(st.opt.map.download&&st.opt.map.zoomButtons.orientation=="v")h.addClass("topRightWithDownloadV");else if(st.opt.map.download)h.addClass("topRightWithDownloadH");else h.addClass("topRight");break;case"tl":h.addClass("topLeft");break;case"br":h.addClass("bottomRight");break;case"bl":default:h.addClass("bottomLeft");break}if(st.opt.map.zoomButtons.orientation=="v")e("button",h).css({display:"block"}).addClass("vertical");else e("button",h).css({display:"inline"}).addClass("horizontal");e(".plus",h).click(function(){W(10/9)});e(".min",h).click(function(){W(9/10)});e(".reset",h).click(function(){W(1);X(0,0);if(typeof c!=="undefined")c.setAttribute("transform","translate("+0+","+0+")")})}if(st.opt.map.download){p=e('<div id="mapExport'+r+'" class="mapExport noprint" style="position: absolute;"><button class="download" title="export/print"></button></div>');p.appendTo(s);var y="";if(svgweb.getHandlerType()=="native")y+='<li><a href="#" class="exportmap" id="exportpng" download="generate_map.png" data-type="image/png">Export to PNG</a></li><li><a href="#" id="exportjpg" class="exportmap" download="generate_map.jpg" data-type="image/jpeg">Export to JPEG</a></li><li><a href="#" id="exportbmp" class="exportmap" download="generate_map.bmp" data-type="image/bmp">Export to BMP</a></li><li><div style="height: 1px; background-color: #eee;"><div></li>';y+='<li><a href="#" class="printmap">Print</a></li>';e('<div class="container-menu" style="display: none; clear: both; padding:5px 10px; border: 1px solid #eee; background: #FFF; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.176);"><ul style="list-style: none; padding: 0; margin: 0;" class="li-ex">'+y+"</ul></div>").appendTo(p);var E=false;e(".download",p).click(function(){if(e(".container-menu",p).is(":hidden"))e(".container-menu",p).show();else e(".container-menu",p).hide()});e(".container-menu",p).mouseover(function(){e(this).show();E=true});e(".container-menu",p).mouseout(function(){E=false});e(".download, .li-ex li a",p).blur(function(){if(!E)e(".container-menu",p).hide()});e(".exportmap",p).click(function(){var t=e(this).attr("data-type");canvg("canvasStatMap",f);var n=document.getElementById("canvasStatMap");var r;if(t=="image/png")r=Z(n,t);else r=Z(n,t,"#FFFFFF");r=r.replace(t,"image/octet-stream");e(this).attr("href",r);if(navigator.appName=="Microsoft Internet Explorer"){var i="<p>Right-click on image below and Save-Picture-As</p>";i+='<img src="'+r+'" alt="generate-map"/>';var s=window.open();s.document.write(i)}});e(".printmap",p).click(function(){window.print()})}u=e('<div id="clr'+r+'" style="clear:both;"></div>');u.appendTo(e(n));if(st.opt.map.svgFile){e("#mapContainer"+r).hide();var t=document.getElementById("mapContainer"+r);var S=document.createElement("object",true);S.setAttribute("id","statMapSVG"+r);S.setAttribute("type","image/svg+xml");S.setAttribute("data",st.opt.map.svgFile);S.setAttribute("width","100%");S.setAttribute("height","100%");S.addEventListener("SVGLoad",function(){f=this.contentDocument;var t=f.rootElement;t.setAttribute("viewBox","0 0 "+t.getAttribute("width")+" "+t.getAttribute("height"));var n=parseFloat(st.opt.map.width)/t.getAttribute("width");var i=parseFloat(st.opt.map.height)/t.getAttribute("height");b=n>i?parseFloat(st.opt.map.height)/t.getAttribute("height")*t.getAttribute("width"):parseFloat(st.opt.map.width);w=n>i?parseFloat(st.opt.map.height):parseFloat(st.opt.map.width)/t.getAttribute("width")*t.getAttribute("height");nt();tt();l=f.nativeGetElementById?f.getElementById("area"):document.all["area"];H();if(st.opt.legend.showLegend||st.opt.legend.showGroupLegend)F();q();it();if(st.opt.map.responsive){if(svgweb.getHandlerType()=="native"){if(e(window).width()<s.width())s.width(e(window).width()-30);if(e(window).height()<s.height())s.height(e(window).height()-10)}e(window).resize(function(){if(st.opt.map.responsive){var t=e(this).width();var n=e(this).height();if(e(this).width()>d)s.width(d);else s.width(e(this).width()-30);if(e(this).height()>v)s.height(v);else s.height(e(this).height()-10)}})}if(e("#loader"+r,s).length>0)e("#loader"+r,s).remove()},false);e("#mapContainer"+r).fadeIn("slow");svgweb.appendChild(S,t)}else if(e("#loader"+r,s).length>0)e("#loader"+r,s).remove();var x="@media print{ .noprint { display:none; } }";var T=document.createElement("style");T.type="text/css";if(T.styleSheet)T.styleSheet.cssText=x;else T.appendChild(document.createTextNode(x));document.getElementsByTagName("head")[0].appendChild(T);var N=document.nativeGetElementById?document.getElementById("canvasStatMap"):document.all["canvasStatMap"];if(typeof N==="undefined"){e('<canvas id="canvasStatMap" style="display:none;"></canvas>').appendTo(e(document.body))}if(st.opt.map.devMode){var C=document.nativeGetElementById?document.getElementById("devArea"):document.all["devArea"];if(typeof C==="undefined"){var k='<div id="devArea">'+"<p><strong>Map Area:</strong></p>"+'<p><label for="idarea">area id :</label> <input type="text" id="idarea" name="idarea"/></p>'+'<p><label for="coordx">coordinates x :</label> <input type="text" id="coordx" name="coordx"/></p>'+'<p><label for="coordy">coordinates y :</label> <input type="text" id="coordy" name="coordy"/></p>'+"</div>";e(k).appendTo(e(document.body))}}},reset:function(t){st=this;var n=st.opt.map.svgFile;P(t);e(et()).appendTo(s);if(n==t.map.svgFile){i.html(st.opt.map.title);s.css("width",st.opt.map.width);s.css("height",st.opt.map.height);var o=document.getElementById("statMapSVG"+r);o.setAttribute("width","100%");o.setAttribute("height","100%");nt();tt();H();F();q();it();d=s.width();v=s.height();if(st.opt.map.responsive){if(svgweb.getHandlerType()=="native"){if(e(window).width()<s.width())s.width(e(window).width()-30);if(e(window).height()<s.height())s.height(e(window).height()-10)}e(window).resize(function(){if(st.opt.map.responsive){var t=e(this).width();var n=e(this).height();if(e(this).width()>d)s.width(d);else s.width(e(this).width()-30);if(e(this).height()>v)s.height(v);else s.height(e(this).height()-10)}})}if(e("#loader"+r,s).length>0)e("#loader"+r,s).remove()}else{st.generate()}},removeSelected:function(e){y="";if(typeof st.opt.data.area[e]!=="undefined")st.opt.data.area[e].selected=false;U(e)}};P(t);n.statMapSVG=st;return n}})(jQuery)